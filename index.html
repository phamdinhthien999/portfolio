<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="ThanhXuan - Portfolio">
  <meta property="og:image" content="/assets/images/preview.png" />
  <title>ThanhXuan - Portfolio</title>

  <script src="https://js-de.sentry-cdn.com/13416dc96f624c1cdd06842b26a1c9f0.min.js" crossorigin="anonymous"></script>

  <script>
    Sentry.onLoad(function () {
      Sentry.init({
        sendDefaultPii: true,
        integrations: [Sentry.browserTracingIntegration({ enableUserInteraction: true })],
        tracesSampleRate: 1.0,
        replaysOnErrorSampleRate: 1.0,
        beforeSendTransaction(event) {
          if (!event) return null;

          const THRESHOLDS = {
            LCP: 2500,
            CLS: 0.1,
            INP: 200,
            FCP: 1000,
            TTFB: 300,
            CLICK_DELAY: 200,
            API_TIMEOUT: 3000
          };

          const op = event.contexts && event.contexts.trace && event.contexts.trace.op;
          const measurements = event.measurements || {};

          // Tính Duration (ms)
          const start = event.start_timestamp || 0;
          const end = event.timestamp || 0;
          const duration = (end - start) * 1000;

          // --- Xử lý Pageload & Navigation ---
          if (op === 'pageload' || op === 'navigation') {
            const lcp = (measurements['lcp'] && measurements['lcp'].value) || 0;
            const cls = (measurements['cls'] && measurements['cls'].value) || 0;
            const inp = (measurements['inp'] && measurements['inp'].value) || 0;
            const fcp = (measurements['fcp'] && measurements['fcp'].value) || 0;
            const ttfb = (measurements['ttfb'] && measurements['ttfb'].value) || 0;

            const isBadExperience =
              lcp > THRESHOLDS.LCP ||
              cls > THRESHOLDS.CLS ||
              inp > THRESHOLDS.INP ||
              fcp > THRESHOLDS.FCP ||
              ttfb > THRESHOLDS.TTFB;

            if (!isBadExperience && op === 'pageload') {
              // 1. Gắn spans về mảng rỗng
              event.spans = [];

              // 2. Xóa bỏ hoàn toàn các chỉ số measurements
              if (event.measurements) {
                const metricsToClear = ['lcp', 'cls', 'inp', 'fcp', 'ttfb', 'fid'];
                metricsToClear.forEach(key => {
                  if (key in event.measurements) {
                    delete event.measurements[key];
                  }
                });
              }

              return event;
            } else {
              return event;
            }
            return null;
            
          }

          // --- Xử lý Tương tác (Click) ---
          if (op === 'ui.interaction.click' || op === 'ui.action') {
            return duration > THRESHOLDS.CLICK_DELAY ? event : null;
          }

          // --- Xử lý API (Fetch/XHR) ---
          if (op === 'http.client') {
            const status = event.contexts && event.contexts.response && event.contexts.response.status_code;
            if ((status && status >= 400) || duration > THRESHOLDS.API_TIMEOUT) {
              return event;
            }
            return null;
          }

          return null;
        }
      });
    });

  </script>

  <!-- favicon -->
  <link rel="shortcut icon" href="/assets/images/logo.svg" type="image/x-icon">

  <!-- google font link -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">
</head>

<body>
  <div id="app"></div>
  <script type="module" src="/src/main.js"></script>

  <!-- ionicon link -->
  <script type="module" src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.esm.js"></script>
  <script nomodule src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.js"></script>
</body>

</html>